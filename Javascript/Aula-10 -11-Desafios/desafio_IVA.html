<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Desafio IVA</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
</head>

<body>
  <div class="container-fluid text-center bg-success p-5">
    <h1>Desafio Iva</h1>
  </div>

  <div id="results" class="container mt-5"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
    crossorigin="anonymous"></script>
  <script>
    const data = [
      {
        client: "Zé Carlos",
        products: [
          {
            product: "Atum",
            iva: 13,
            preco: 4
          }, {
            product: "Coca-Cola",
            iva: 23,
            preco: 2
          }, {
            product: "Agua",
            iva: 6,
            preco: 1
          }
        ]
      }, {
        client: "Zé Manel",
        products: [{
          product: "Bolachas",
          iva: 23,
          preco: 3
        }, {
          product: "Coca-Cola",
          iva: 23,
          preco: 2
        }]
      }]

    /********************************************************************************
     *
     *       Desafio: Adicionar iva aos produtos e apresentar os totais por cliente.
     *
     ********************************************************************************/

    //  Add Logic
    document.addEventListener("DOMContentLoaded", (event) => {
      desafioIvaForOf();
      // desafioIvaMapForEach();
    });

    const desafioIvaForOf = () => {
      for (const client of data) {
        client.total = 0;
        for (const product of client.products) {
          product.PVP = product.preco * (1 + product.iva / 100);
          client.total += product.PVP;
        }
        showClientAsHtmlTable(client);
      }
    }

    const desafioIvaMapForEach = () => {
      data.map((client) => {
        client.total = 0;
        client.products.forEach((product) => {
          product.PVP = product.preco * (1 + product.iva / 100);
          client.total += product.PVP;
        })
        showClientAsHtmlTable(client);
      })
    }

    function showClientAsHtmlTable(client) {
      // https://getbootstrap.com/docs/5.2/content/tables/
      document.getElementById('results').insertAdjacentHTML(
        "afterbegin",
        `<table class="table table-dark">
            <tbody>
              <tr>
                <th>Client : </th>
                <td>${client.client}</td>
              </tr>
              <tr>
                <th>Total Bill : </th>
                <td>${client.total}</td>
              </tr>
            </tbody>
        </table>`
      )
    }
  </script>
</body>

</html>