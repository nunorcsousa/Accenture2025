<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Desafio IVA</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
</head>

<body>
  <!-- init html code -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
    crossorigin="anonymous"></script>
  <script>
    const data = [
      {
        client: "Zé Carlos",
        products: [
          {
            product: "Atum",
            iva: 13,
            preco: 4
          }, {
            product: "Coca-Cola",
            iva: 23,
            preco: 2
          }, {
            product: "Agua",
            iva: 6,
            preco: 1
          }
        ]
      }, {
        client: "Zé Manel",
        products: [{
          product: "Bolachas",
          iva: 23,
          preco: 3
        }, {
          product: "Coca-Cola",
          iva: 23,
          preco: 2
        }]
      }]

    /********************************************************************************
     *
     *       Desafio: Adicionar iva aos produtos e apresentar os totais por cliente.
     *
     ********************************************************************************/

    //  Add Logic
    
    let totalPrice = 0;

    // Percorrer todos os clientes na lista "data"
    data.forEach((entry) => {
        let subTotalPrice = 0;

        // Apresentar o nome do cliente
        console.log('Cliente: ' + entry.client);

        // Percorrer todos os produtos do cliente
        entry.products.forEach((product) => {
            // Calcular o preço com IVA corretamente
            let price = product.preco * (1 + (product.iva / 100));

            // Acumular o subtotal do cliente
            subTotalPrice += price;

            // Apresentar o nome do produto e o preço com duas casas decimais
            console.log('Produto: ' + product.product + ' - ' + price.toFixed(2) + ' €');
        });

        // Apresentar o subtotal do cliente com duas casas decimais
        console.log('Subtotal: ' + subTotalPrice.toFixed(2) + ' €');

        // Acumular o total geral
        totalPrice += subTotalPrice;
    });

    // Apresentar o total geral com duas casas decimais
    console.log('TOTAL: ' + totalPrice.toFixed(2) + ' €');


  </script>
</body>

</html>